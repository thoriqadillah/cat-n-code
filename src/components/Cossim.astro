---
import Button from "./Button.astro";
---

<div class="mb-2">
  <label for="lang" class="text-bright font-bold mr-3">Language</label>
  <select name="lang" id="lang" class="prose dark:prose-invert bg-dark p-2 rounded-md">
    <option selected value="none">None</option>
    <option value="en">English</option>
    <option value="id">Indonesia</option>
  </select>
</div>

<div class="flex flex-col md:flex-row">
  <textarea class="prose dark:prose-invert docs bg-dark rounded-md w-full p-3 mb-2 md:mr-2 h-36" placeholder="Write something"/>
  <textarea class="prose dark:prose-invert docs bg-dark rounded-md w-full p-3 mb-1 h-36" placeholder="Write something else"/>
</div>

<Button color="second" roundtype="md" classname="calculate mt-1">Calculate</Button>
<p id="result" class="text-second inline p-2 font-bold ml-auto"></p>

<script>
  import Preprocessing from '../services/preprocessing'
  import CosineSimilarity from '../services/cosine-similarity'

  import Matrix from 'src/services/transformers/matrix'
  import LSA from 'src/services/transformers/LSA'
  
  const cossim = new CosineSimilarity()

  const inputs = document.querySelectorAll('.docs') as NodeListOf<HTMLInputElement>
  const btn = document.querySelector('.calculate') as HTMLElement
  const p = document.querySelector('#result') as HTMLElement
  const lang = document.querySelector('#lang') as HTMLInputElement
  
  btn.onclick = () => {  
    const documents: string[] = []
    inputs.forEach(el => documents.push(el.value))
    
    let vectors = Preprocessing.preprocess(documents, lang.value)
    const matrix = new Matrix(vectors);
    vectors = new LSA(matrix).transform()
    
    const similarity = cossim.getSimilarity(vectors[0], vectors[1])
    p.innerHTML = 'Similarity: ' + Math.round(similarity).toString() + '%'
  }

</script>